---
layout: post
title: 网站开放（上线）
date: 2022-04-22
category: projects
tags: 
- website
- software
excerpt: "经历漫长的研究，攻克难关，和父母讨价还价
网站总算是上线了
今天来讲一讲这个网站是如何上线以及经历了一些怎么样意想不到的波折
如果你想学习网站上线，这篇文章可以帮到你"
---

#### OK回来了


经历漫长的研究，攻克难关，和父母讨价还价

网站总算是上线了

今天来讲一讲这个网站是如何上线以及经历了一些怎么样意想不到的波折

如果你想学习网站上线，这篇文章可以帮到你

（前面介绍如何在外网访问你的网站，文末统一解释如何配置域名及域名的DNS服务）

首先，想要上线一个网站，我们要了解

## 访问网站的原理

*自动脑补炫酷的音乐和闪烁的标题*

要知道，网站是架在服务器上的文件（仅限静态页面），通过复杂的通路找到访问网站的浏览器并渲染画面。

那么，架在局域网的网站无法被访问当然就是浏览器找不到服务器咯

所以我们要搭建一条通路：）

首先，来看看：

### 最简单的一种

![通路-最简单的一种](/images/post/2022-04-22-02.png)

在这个图片中，用户访问 ```www.baidu.com``` ，通过一些复杂的网络通信手段找到了ipv4地址为 ```220.181.38.148``` 的服务器，获取数据（页面）并渲染。

如果再精细一点的话（此处我不知道域名baidu.com的虚拟运营商，假设是阿里云）

用户访问 ```baidu.com``` 后找到了阿里云的DNS服务器，通过DNS服务器得知百度服务器ipv4地址为 ```220.181.38.148``` 之后前往服务器获取数据

如果你的服务器是云服务器，通路也是这样的，所以恭喜你，你的问题已经解决了，按照服务商的文档或者什么的行事不会有问题（此方法需要备案域名，在服务商那里）

很可惜，我的情况并没有这么简单，所以我们继续：

### 不是云服务器

这说明你的服务器在自己家里或者什么别的地方（废话）

那么，你的服务器可能没有适合的网络环境

别急，没有环境我们自己造：）

#### 公网ip

请自行检查自己家里是否是公网ip

如果是，那么恭喜你，你的情况也比较简单

如果不是，请跳跃至申请非公网ip，接着读可能会让你白忙活

实际上，你只是需要以和云服务器相同的方式配置域名

将域名指向ip地址

但是很明显，ip地址不是一成不变的

所以我们需要使用：__DDNS__

DNS服务器是一直开启的，ip地址不会经常变化

但你的服务器可就不一定了

所以我们可以在DNS前面加上动态“D”，就成为了“动态域名解析”

具体如何配置？

由于我没有除tplink以外的可用路由器，所以我就以tplink（云路由界面）进行演示，应该都大同小异，如果实在不一样，可以尝试联系路由器官网的客服之类的

首先，登陆路由器管理界面（tplogin.cn或192.168.1.1之类的）

密码应该在路由器背面

接着，点击下方的应用管理

点击DDNS下面的“进入”

![点击](/images/post/2022-04-22-01.png)

此处有两个选项：tplink路由器提供DDNS和花生壳提供DDNS

![tplink提供的DDNS](/images/post/2022-04-22-03.png)

请注意，一个路由器账号只能有一个而且 __不能删除！！__ 请注意！注册以前请慎重

也可以使用花生壳提供的DDNS，只不过DDNS的管理界面会在花生壳官网

DDNS只能让外网访问到你的路由器，并不能在外网访问你的服务器

所以请配置虚拟主机

![虚拟主机配置](/images/post/2022-04-22-04.png)

外部端口即为访问时的端口

内部端口为内网服务端口

ip地址为内网服务器ip

协议类型请选择TCP

外部端口选择80（常用服务器自动设置为HTTP）在浏览器中可以不带端口访问

但9000以下的端口可能会被封禁，此处我选择9090

如果没问题的话此时你可以直接访问DDNS设置的域名直接访问了

如果有问题：

1. 内网服务未配置，没服务怎么访问

2. 网关配置问题，不太懂，一般服务器能连接网络，正常上网就可以

3. 端口开发不完全，在路由器配置DMZ主机解决

4. 非公网IP

#### 非公网ip

方案一，没有公网ip就申请一个

我这边是天津联通，来进行一个嫖

1. 访问[联通官网](10010.com)，联系客服 -> 转人工 -> 跟他说申请公网ip，可能会让你找营业厅

2. 访问百度地图，找到最近的营业厅，拨打电话

3. 说申请公网ip，他可能不承认这个业务，告诉他10010让你找他

4. 建立工单

5. 等待

6. 师傅打来电话，添加师傅微信

7. 发送身份证正反面，手持身份证上半身照片，公网ip用途

。。。

然后。。然后我就不知道了，我在这里卡住了。。。

与父母协商失败。。。

接下来大概就是师傅上门，给你改，断网一会，然后就好了

那既然协商失败了，换一个方案呗

方案2，内网穿透

算是祭出杀手锏了，除了缺点以外基本没有缺点了

此方案甚至适用于我的世界服务器

首先介绍一个好用的内网穿透：[樱花穿透SakuraFrp](https://natfrp.com)

内网穿透，顾名思义冲破内网的限制，让你就像公网ip一样，还可以只开特定设备的特定端口

注册，登陆，花一块钱实名一下，点击帮助->帮助文档

照着他的做就行了（这里不详细讲，文档十分详细了）

阅读顺序：

HTTP(S)穿透

linux安装及使用启动器

完成以后使用鼠标悬停节点出现的冒号分类里的数字来访问

到这里，公网已经可以访问了

那下一步就是把这个又臭又长的地址美化一下了：）

## 附--域名及DNS服务器配置

要知道，baidu.com和www.baidu.com是两个不同的地址

买下baidu.com这个域名会获得所以子域名（三级四级五级）

www就是baidu.com的三级域名

（使用阿里云演示）

打开阿里云官网，登陆，右上角控制台，域名，域名解析

添加解析记录

解析类型CNAME，记录值baidu.com，主机名@

这样一个解析会将你的域名重定向到baidu.com

@的意思是直接访问你的域名不加前缀

例如我的域名是mhyc.tech，加上这个解析之后浏览器输入mhyc.tech会直接到百度家

现在你可以理解阿里云的解析原理和特性，应该来解决实际问题了

## 域名太丑

开开心心在阿里云控制台输入内网穿透的域名加端口，竟发现CNAME解析不能加端口

怎么办，访问 mhyc.tech:端口号 实在是太不优雅了

。。

我们能不能再加一个服务器，使这个服务器指向网页服务器，使域名指向这个服务器？

隆重介绍：

### URL转发

定义及分类可以自行百度。

这里推荐一个URL转发的工具[米发URL转发](https://mfpad.com)

通过他可以将域名指向另一个域名加端口

现在，访问你的网站流程是这样的：

![最复杂的情况](/images/post/2022-04-22-05.png)

注：此方法目前的问题：

1. 网页无图标

2. 刷新页面回到主页（真的难受）

3. 未出现。。。

现在正在试图解决这几个问题，如有进展会立即补充

---

## 2022-06-17 22:05

刚发现，natfrp文档更新了，在https教程中添加了几条，因此我想起是否可以使用海外隧道

创建海外隧道（可能带后缀"被墙"）

按照文档行事，就可以完全解决关于网站开设的所有问题

恭喜！

-----
参考链接

[Tplink端口映射（DDNS）教程](https://service.tp-link.com.cn/detail_article_69.html)

[tplink端口映射失败（官方教程）](https://service.tp-link.com.cn/detail_article_427.html)

[阿里云官网](cn.aliyun.com)

[米发URL转发](https://mfpad.com)
